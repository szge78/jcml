# JCML (Java Config Message Log)

Micronaut-based service for processing and analyzing CML (Configuration Message Log) data from Cisco Unified Contact Center Enterprise (UCCE).

## Features
- **SOAP & REST Endpoints**: Retrieve deserialized and processed CML messages.
- **Configurable Pipeline**: JSON-defined processing pipeline for transformation, filtering, and enrichment.
- **Parallel Processing**: High-performance deserialization and transformation using Java 21 Virtual Threads.
- **Schema-driven Deserialization**: Binary data extraction based on JSON schema definitions.
- **Database Integration**: Direct access to UCCE `Config_Message_Log` tables.

## Quick Start

### Build
```bash
./gradlew build
```

### Run
```bash
./gradlew run
```

The application will be available on port 8080 (by default).

## Configuration
Pipeline configuration is located in `src/main/resources/pipeline.json`.
Database connection and other settings are in `src/main/resources/application.yml`.

## Technologies
- **Java 25**: Leveraging the latest language features and performance.
- **Micronaut 4.6.1**: Modern, JVM-based, full-stack framework for building modular, easily testable microservice and serverless applications.
- **Apache CXF 4.0.4**: Robust SOAP services implementation.
- **Java Virtual Threads**: High-performance parallel processing of message pipelines.
- **Micronaut Data JDBC**: Efficient database access to UCCE `Config_Message_Log`.
- **Josson**: JSON-to-JSON transformation and expression language for the pipeline.
- **Janino**: High-performance runtime Java compiler for conditional logging.

## Pipeline & Actions
The JCML pipeline is a sequence of processing steps defined in `pipeline.json`. Each step (Action) operates on a batch of messages, transforming, filtering, or enriching them.

### Processing Workflow
1. **Extraction**: Messages are retrieved from the database and deserialized based on JSON schemas.
2. **Pipeline Execution**: Messages pass through a series of configurable actions.
3. **Delivery**: Final processed messages are served via SOAP or REST.

### Available Actions
- **`CmlHeaderExtractorAction`**: Extracts common fields (like `cmlId`) from the binary header and stores them in the session context for correlation.
- **`EntityPreloadAction`**: Preloads UCCE configuration tables (e.g., `Agent`, `PrecisionQueue`) into the session context for fast lookups.
- **`NativeSqlPreloadAction`**: Similar to `EntityPreloadAction` but uses custom SQL queries for complex data retrieval.
- **`SessionEnrichAction`**: Enriches messages with data from the session context (preloaded entities) using CML IDs. It also stamps a stable `_cmlTransactionId` for transaction-level operations.
- **`CmlTransactionFilterAction`**: Filters out entire transactions based on configurable conditions (e.g., dropping messages from service accounts).
- **`ArrayUnwrapAction`**: Flattens nested arrays within messages into multiple top-level records, useful for processing multi-item CML updates.
- **`BatchTemplateAction`**: Applies dynamic string templates to fields using the Josson expression language for human-readable descriptions.
- **`TimestampConverterAction`**: Converts Windows FileTime timestamps into Unix epoch and ISO-8601 human-readable formats.
- **`SortAction`**: Sorts the batch of messages based on multiple configurable keys (e.g., recovery key, timestamp).
- **`ContextDumpAction`**: A diagnostic tool that logs the current state of Global and Session contexts (executes once per session).

---
*Generated by Micronaut 4.10.7*


